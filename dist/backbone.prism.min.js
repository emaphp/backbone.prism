!function(a,b){"use strict";if("function"==typeof define&&define.amd)define(["backbone","underscore","react","flux","backbone.radio"],function(c,d,e,f){return b(a,c,d,e,f)});else if("undefined"!=typeof exports){require("backbone.radio");module.exports=b(a,require("backbone"),require("underscore"),require("react"),require("flux"))}else b(a,a.Backbone,a._,a.React,a.Flux)}(this,function(a,b,c,d,e){"use strict";var f=b.Prism=b.Prism||{};f.VERSION="1.3.0",f.extend=b.Model.extend;var g=function(a,b){a&&c.extend(this,c.pick(a,b))},h=function(a,b){return a&&b?a.options&&void 0!==a.options[b]?a.options[b]:a[b]:void 0},i=function(a){return h(this,a)},j=function(a){return a=a||{},this.trigger("before:destroy",a),this.trigger("destroy",a),this.stopListening(),this},k=function(a){var b=c.matches(a);return function(a){return b(a.attributes)}},l=function(a,b){return c.isFunction(a)?a:c.isObject(a)&&!b._isModel(a)?k(a):c.isString(a)?function(b){return b.get(a)}:a},m=function(a,b,d){switch(a){case 1:return function(){return c[b](this[d])};case 2:return function(a){return c[b](this[d],a)};case 3:return function(a,e){return c[b](this[d],l(a,this),e)};case 4:return function(a,e,f){return c[b](this[d],l(a,this),e,f)};default:return function(){var a=slice.call(arguments);return a.unshift(this[d]),c[b].apply(c,a)}}},n=function(a,b,d){c.each(b,function(b,e){c[e]&&(a.prototype[e]=m(b,e,d))})};f.Object=function(a){this.options=c.extend({},c.result(this,"options"),a),this.initialize.apply(this,arguments)},c.extend(f.Object.prototype,b.Events,{initialize:function(){},mergeOptions:g,getOption:i,destroy:j}),f.Object.extend=f.extend,f.ChannelMixin=c.extend({reset:function(){return this.off(),this.stopListening(),this.stopReplying(),this},destroy:function(a){return a=a||{},this.trigger("before:destroy",a),this.trigger("destroy",a),this.off(),this.stopListening(),this.stopReplying(),this}},b.Radio.Requests),f.Channel=f.Object.extend(f.ChannelMixin),f.Radio=b.Radio,f.Events=c.extend({},b.Events,b.Radio.Requests),f.Dispatcher=function(){e.Dispatcher.prototype.constructor.apply(this,arguments)},f.Dispatcher.prototype=new e.Dispatcher,c.extend(f.Dispatcher.prototype,{handleViewAction:function(a){return this.dispatch({source:"view",action:a})},handleServerAction:function(a){return this.dispatch({source:"server",action:a})}});var o=f.Object.extend({initialize:function(a,b,c){this.view=a,this.component=b,this.callback=c,this.listenTo(a,"wakeup",this.eval(!0))},apply:function(a){c.extend(this.view.options,this.callback.call(this.component)),a||this.trigger("set",this)},eval:function(a){return function(){this.apply(a)}.bind(this)},updateComponentState:function(a,b){c.extend(this.component.state,a),this.apply(b)}});f.ViewConfig=o;var p=o.extend({apply:function(a){c.extend(this.view.options,{comparator:this.callback.call(this.component)}),a||this.trigger("set",this)}});f.ViewComparator=p;var q=o.extend({apply:function(a){this.view.options.filters=this.view.options.filters||{},this.view.options.filters[this.cid]=this.callback.call(this.component),a||this.trigger("set",this)}});f.ViewFilter=q;var r=o.extend({initialize:function(a,b,c,d){o.prototype.initialize.call(this,a,b),this.pageSize=c||10,this.page=d||1},getPage:function(){return this.page},setPage:function(a){return this.page=a,a},setCurrentPage:function(a,b){this.page=a,this.apply(!b)},getPageSize:function(){return this.pageSize},setPageSize:function(a){return this.pageSize=a,a},getTotalPages:function(a){return Math.ceil(a/this.pageSize)},apply:function(a){c.extend(this.view.options,{size:this.pageSize,offset:this.pageSize*(this.page-1)}),a||this.trigger("set",this)}});f.ViewPaginator=r;var s=c.extend({configs:{},isInitialized:function(){return!!this._isInitialized},isActive:function(){return!!this._isActive},sleep:function(){this.stopListening(this.parent,this.options.listenTo),this._isActive=!1},wakeup:function(a){this.listenTo(this.parent,this.options.listenTo,this.sync),this._isActive=!0,a&&this.sync()},createConfig:function(a,b){var d=new o(this,a,b);return d.cid=c.uniqueId("config"),this._storeConfig(d),d},_storeConfig:function(a){this.listenTo(a,"set",function(){this.sync()}),this.listenTo(a,"destroy",function(){this.stopListening(a),delete this.configs[a.cid],this.sync()}),this.configs[a.cid]=a}},b.Events),t={views:{},getView:function(a){return this.views[a]},getDefaultView:function(a){return this.views["default"]?this.views["default"]:this.createView(c.extend(a||{},{name:"default"}))}},u={createView:function(a){a=a||{};var b=new v(this,a);return b.name=a.name||c.uniqueId("view"),this.views[b.name]=b,this.listenTo(b,"destroy",function(){delete this.views[b.name]}),b}};c.extend(u,t);var v=f.StoreView=function(a,b){this.parent=a,this.models=[],this.length=0,this._isInitialized=!1,this.options=c.extend({},c.result(this,"options"),b),this.options.listenTo=this.options.listenTo||"add remove change reset",this.listenTo(a,"publish",function(){this.trigger("wakeup",!0),this.wakeup(!1),this._isInitialized=!0,this.sync(),this.trigger("publish")}),this.initialize.apply(this,arguments)};c.extend(v.prototype,s,u,{initialize:function(){},sync:function(){if(this._isActive){if(this.models=c.clone(this.parent.models),this.options.filter)if(c.isFunction(this.options.filter))this.models=this.filter(this.options.filter);else if(c.isObject(this.options.filter)){var a=c.matches(this.options.filter);this.models=this.filter(function(b){return a(b.attributes)})}if(this.options.filters&&c.each(this.options.filters,function(a){if(c.isFunction(a))this.models=this.filter(a);else if(c.isObject()){var b=c.matches(a);this.models=this.filter(function(a){return b(a.attributes)})}}.bind(this)),this.options.comparator&&(c.isString(this.options.comparator)||1===this.options.comparator.length?this.models=this.sortBy(this.options.comparator,this):this.models.sort(this.options.comparator.bind(this))),this.options.size||"undefined"!=typeof this.options.offset){var b=this.models.length,d=this.options.size||b,e="undefined"==typeof this.options.offset?0:Math.abs(this.options.offset);if(d>0)this.models=this.models.slice(e,e+d);else if(0>d){var f=Math.abs(b+d-e);this.models=this.models.slice(f,b-e)}}this.length=this.models.length,this.trigger("sync")}},toJSON:function(){return this.models.map(function(a){return c.extend({cid:a.cid},a.toJSON())})},createFilter:function(a,b){var d=new q(this,a,b);return d.cid=c.uniqueId("filter"),this._storeConfig(d),d},createComparator:function(a,b){var d=new p(this,a,b);return d.cid=c.uniqueId("comparator"),this._storeConfig(d),d},createPaginator:function(a,b,d){var e=new r(this,a,b,d);return e.cid=c.uniqueId("paginator"),this._storeConfig(e),e},destroy:j}),v.extend=b.Model.extend;var w={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};n(v,w,"models");var x={_isInitialized:!1,publish:function(){this.trigger("publish"),this._isInitialized=!0}};f.StoreMixin=c.extend({constructor:function(a,c){this.views={},b.Collection.apply(this,arguments)}},x,u),f.Store=b.Collection.extend(f.StoreMixin);var y={createView:function(a){a=a||{};var b=new z(this,a);return b.name=a.name?a.name:c.uniqueId("view"),this.views[b.name]=b,this.listenTo(b,"destroy",function(){delete this.views[b.name]}),b}};c.extend(y,t);var z=f.StateView=function(a,b){this.parent=a,this.options=c.extend({},c.result(this,"options"),b),this.options.listenTo=this.options.listenTo||"change",this._isInitialized=!1,this._isActive=!1,this.listenTo(a,"publish",function(){this.trigger("wakeup",!0),this.wakeup(!1),this._isInitialized=!0,this.sync(),this.trigger("publish")}),this.initialize.apply(this,arguments)};c.extend(z.prototype,s,y,{initialize:function(){},sync:function(){this._isActive&&(this.attributes=this.parent.cid?c.extend({cid:this.parent.cid},this.parent.attributes):c.extend({},this.parent.attributes),this.trigger("sync"))},toJSON:function(){return c.extend({cid:this.parent.cid},this.attributes)},destroy:j}),z.extend=b.Model.extend;var A={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};n(z,A,"attributes"),f.StateMixin=c.extend({constructor:function(a,c){this.views={},b.Model.apply(this,arguments)}},x,y),f.State=b.Model.extend(f.StateMixin);var B=function(a,b){c.isFunction(b.prototype.viewUpdate)?b.prototype.viewUpdate.call(this,a):c.isFunction(b.prototype.viewTransform)?this.setState(b.prototype.viewTransform.call(this,a)):this.forceUpdate()};return f.compose=function(a,b,e){var g=d.createClass({componentWillMount:function(){var d=this;c.isArray(b)?c.each(b,function(b){d.listenTo(d.props[b],"sync",function(){c.isFunction(e)?e.call(d,d.props[b],a):B.call(d,d.props[b],a)})}):this.listenTo(this.props[b],"sync",function(){c.isFunction(e)?e.call(d,d.props[b],a):B.call(d,d.props[b],a)})},componentWillUnmount:function(){var a=this;c.isArray(b)?c.each(b,function(b){a.stopListening(a.props[b],"sync")}):this.stopListening(this.props[b],"sync")},render:function(){var b=this,e={$value:function(a){return b.state?b.state[a]:void 0},$state:function(){return b.state},$parent:function(){return b}};return d.createElement(a,c.extend(e,this.props))}});return c.extend(g.prototype,f.Events),g},f});